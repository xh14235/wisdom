<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | LMXC</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
      var unityInstance = UnityLoader.instantiate("unityContainer", "Build/BuddlePackage.json", {onProgress: UnityProgress});
    </script>
    <style>
      .footer{display: none;}
      .webgl-content{width: 100vw; height: 100vh;}
      #unityContainer{width: 100vw!important; height: 100vh!important;}
    </style>
  </head>
  <body>
    <div class="webgl-content">
      <div id="unityContainer" style="width: 960px; height: 600px"></div>
      <div class="footer">
        <div class="webgl-logo"></div>
        <div class="fullscreen" onclick="unityInstance.SetFullscreen(1)"></div>
        <div class="title">LMXC</div>
      </div>
    </div>
  </body>
</html>

<script>
  //3d场景是否加载完毕，当值为true时，可正常调用3d场景接口
  var isLoaded = false;

  //U3D调用前端，表明3D场景加载完毕，3d调用前端
  function InitFinished(){
    isLoaded = true
    localStorage.isLoaded = isLoaded
  }

  //U3D点击建筑物或者标签（标签和建筑物看需求是不是要做区分）,3d调用前端
  function SelectMark(markName, id){
    console.log(markName)
    console.log(id)
    window.top.postMessage({markName, id});
  }

  //对摄像机进行运镜（按照经纬度）,前端调用3d
  function setCameraSettingWithCoordinate(data){
    if (isLoaded){
      var data = JSON.stringify(data)
      unityInstance.SendMessage("Net","SetCameraSettingWithCoordinate", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

   //打标,前端调用3d，前端调用3d
  function setMarkData(data){
    if (isLoaded){
      var data = JSON.stringify(data);
      unityInstance.SendMessage("Net","SetMarkData", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //清空3d场景中的打标，前端调用3d
  function clearMarks(){
    if (isLoaded){
      unityInstance.SendMessage("Net","ClearMarkData");
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //设置936能源馆的样式，前端调用3d
  //data:"节能","常规","豪华"
  function setPowerBuilding(data){
    console.log(data)
    if (isLoaded){
      unityInstance.SendMessage("Net","SetStyle", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //设置时间，前端调用3d
  //data:时间为24小时制，可以设置任意时间点的字符串，比如"9","18"
  function setDayTime(data){
    if (isLoaded){
      unityInstance.SendMessage("Net","SetDayTime", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //设置能流图，前端调用3d
  //data:"true"、"false"
  function activePipeNetWork(data){
    if (isLoaded){
      unityInstance.SendMessage("Net","ActivePipeNetWork", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }


  //设置道路状态，前端调用3d
  //data:路名_状态，例如"鹿明湖路_1",状态：0：无拥堵状态显示就是正常的道路、1：通畅、2：较拥堵、3：拥堵不通
  function setRoadStatus(data){
    if (isLoaded){
      unityInstance.SendMessage("Net","SetRoadStatus", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //设置热力图效果，前端调用3d
  //data:[{"Longitude":"121.6844","Latitude":"31.08633","Height":"0.08368874","Status":"2"}],Status: 0：正常, 1：稀疏，3:密集
  //去除热力图可以传[]
  function showPeopleHeatingItem(data){
    if (isLoaded){
      var data = JSON.stringify(data);
      unityInstance.SendMessage("Net","ShowPeopleHeatingItem", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //隐藏指定标签，前端调用3d
  //data: Type加上id,例如："能源报警_1"
  function hideMarkById(data){
    if (isLoaded){
      unityInstance.SendMessage("Net","HideMarkById", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }
  

  //设置天气，前端调用3d
  //data:"雾霾"、"雨"、"雪"、"无"
  function setWeather(data){
    if (isLoaded){
      unityInstance.SendMessage("Net","SetWeather", data);
    } else {
      console.log("3D场景加载中...请稍等");
    }
  }

  //example场景中心切换
  // var center = { 
  //   "Distance": "0.8", //3d当中的摄像机离地面的距离
  //   "PosX": "121.6848", //经度
  //   "PosY": "31.08706", //纬度
  //   "Time": 1, //动画运镜时间
  //   "X": "90", //摄像机横向旋转角度
  //   "Y": "45" //摄像机纵向旋转角度
  //   }
  //   setCameraSettingWithCoordinate(center)

  //example打标
  // var marks = 
  //   [ 
  //     { 
  //       "Height": "0.2", //标点高度
  //       "Id": "0", //标点唯一标识
  //       "Latitude": "31.08706", //纬度
  //       "Longitude": "121.6848", //经度
  //       "Name": "936能源馆", //标点名称
  //       "Type": "936能源馆", //Type为：936能源中心,936能源馆,充电桩,村委,地埋管,电动旅游船,电动汽车,电动自行车,合作社,河道抛管,集中储能,集中风电,集中光伏,监控,空气监测点,空气源热泵,垃圾回收中心,冷水机组,玫瑰工坊,民生报警,民宿,民宅,能源报警,能源中心,生物质锅炉,水质监测点,太阳能,停车位,外来电,网红打卡点,主题活动广场
  //       "Value": "36kW", //如果为空请传空字符串即 ""
  //       "Other": [{"Key":"累计利润","Value":"53万元"},{"Key":"电","Value":"77kWh"},{"Key":"热水","Value":"34吨"}]
  //     }
  //   ];
  //   setMarkData(marks)
</script>